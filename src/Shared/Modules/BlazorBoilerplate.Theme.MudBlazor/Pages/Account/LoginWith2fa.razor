@inherits LoginWith2faPage
@page "/account/loginwith2fa"

@layout LoginLayout

<AuthorizeView Context="AuthorizeContext">
    <Authorized>
        <LoadingBackground>
            <label>@L["Loading"]</label>
        </LoadingBackground>
    </Authorized>
    <NotAuthorized>
        @if (RedirectInProgress)
        {
            <LoadingBackground>
                <label>@L["Loading"]</label>
            </LoadingBackground>
        }
        else
        {
            <MudCard>
                <div class="hidden-mdc-down">
                    <MudIconButton Icon="@Icons.Filled.Home" Class="float-left" Link="/" />
                </div>
                <div class="logo">
                    <a href="/" title="@appState.AppName Home"><img src=@($"{Module.ContentPath}/images/logo.svg") style="width:100px;" title="@appState.AppName Home" alt="@appState.AppName" /><br />@appState.AppName</a>
                    <br />
                    <h4>@L["Log in"]</h4>
                </div>
                <EditForm Model="@loginViewModel" OnValidSubmit="@SubmitLogin">
                    <FluentValidationValidator />
                    <ValidationSummary />
                    <fieldset>
                        <div class="form-group">
                            <MudTextField AutoFocus="true" @bind-Value="@loginViewModel.TwoFactorCode" Label=@L["Code"] AdornmentIcon="@Icons.Material.Outlined.Lock" Adornment="Adornment.End" FullWidth="true" Required="true" InputType="InputType.Password" tabindex="1"></MudTextField>                            
                        </div>
                        <div class="form-group">
                            <MudButton class="float-right" ButtonType="ButtonType.Submit" tabindex="2">@L["Login"]</MudButton>
                            <MudCheckBox @bind-Checked="@loginViewModel.RememberMachine" class="filled-in chk-col-blue">@L["RememberBrowser"]</MudCheckBox>
                        </div>
                    </fieldset>
                </EditForm>
            </MudCard>
            <MudExpansionPanels>
                <MudExpansionPanel @bind-Expanded="@forgotAuthenticatorToggle">
                    <TitleContent>
                        @L["ForgotAuthenticator"]
                    </TitleContent>
                    <ChildContent>
                        <EditForm Model="@forgotAuthenticatorInputModel" OnValidSubmit="@ForgotAuthenticator">
                            <FluentValidationValidator />
                            <ValidationSummary />
                            <div class="form-group">
                                <MudTextField @bind-Value="@forgotAuthenticatorInputModel.RecoveryCode" Label=@L["RecoveryCode"] AdornmentIcon="@Icons.Material.Outlined.Lock" Adornment="Adornment.End" FullWidth="true" Required="true" InputType="InputType.Password"></MudTextField>
                            </div>
                            <div class="form-group">
                                <MudButton class="float-right" ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">@L["Login"]</MudButton>
                            </div>
                        </EditForm>
                    </ChildContent>
                </MudExpansionPanel>
            </MudExpansionPanels>
        }
    </NotAuthorized>
</AuthorizeView>
@code {
    
}
