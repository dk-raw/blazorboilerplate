@inherits DbLogViewerPage
@page "/admin/dblog"

@attribute [Authorize(Policies.IsAdmin)]
@layout AdminLayout

<TopSection>
    <Breadcrumbs>
        <Breadcrumb Link="/admin" Title=@L["BreadCrumbadmin"] />
        <Breadcrumb Title=@L["BreadCrumbadmindblog"] />
    </Breadcrumbs>
</TopSection>

<h1>Db Log Viewer</h1>
<p>
    Paginated viewing and fetching of system logs from the database.
</p>

@if (dbLogItems == null)
{
    <LoadingBackground>
        <label>@L["Loading"]</label>
    </LoadingBackground>
}
else
{
<MudSelect Value="DebugLevel" ValueChanged="(string i) => LoadData(i)">
    @foreach (var item in DebugLevels)
    {
        <MudSelectItem Value="@item">@item</MudSelectItem>
    }
</MudSelect>
<MudTable Items="@dbLogItems" Class="mat-elevation-z5" Striped="true">
    <HeaderContent>
        <MudTh>Timestamp</MudTh>
        <MudTh>Logging Level</MudTh>
        <MudTh>Log Message</MudTh>
        <MudTh>Exception</MudTh>
        <MudTh>Recorded Properties</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd><span style="font-size:small">@context.TimeStamp.ToString()</span></MudTd>
        <MudTd><span style="font-size:small">@context.Level</span></MudTd>
        <MudTd><span style="font-size:small">@context.Message</span></MudTd>
        <MudTd><span style="font-size:small">@context.Exception?.ToString()</span></MudTd>
        <MudTd>
            @if (context.LogProperties?.Any() ?? false)
                {
                <ul>
                    @foreach (var propertyPair in context.LogProperties)
                        {
                        <li style="font-size:small">@($"{propertyPair.Key}:  {propertyPair.Value}")</li>
                        }
                </ul>
                }
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
}

@code {
}
